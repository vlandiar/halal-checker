<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malaysia Halal Status Checker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function HalalChecker() {
            const [keyword, setKeyword] = useState('');
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [searched, setSearched] = useState(false);

            const searchHalalStatus = async (searchTerm) => {
                if (!searchTerm.trim()) {
                    setError('Please enter a keyword to search');
                    return;
                }

                setLoading(true);
                setError('');
                setResults([]);
                setSearched(true);

                try {
                    // Search the Malaysian Halal Portal API using CORS proxy
                    const apiUrl = `https://myehalal.halal.gov.my/portal-halal/v1/search?keyword=${encodeURIComponent(searchTerm)}`;
                    
                    // Try direct fetch first
                    let response;
                    try {
                        response = await fetch(apiUrl);
                    } catch (corsError) {
                        // If CORS error, try with proxy
                        response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`);
                    }
                    
                    if (!response.ok) {
                        throw new Error(`API returned status ${response.status}`);
                    }

                    const data = await response.json();
                    
                    if (data && data.items && Array.isArray(data.items)) {
                        setResults(data.items);
                    } else if (data && Array.isArray(data)) {
                        setResults(data);
                    } else {
                        setResults([]);
                    }
                } catch (err) {
                    console.error('Search error:', err);
                    setError('Unable to search the Halal Portal. Please check your connection or try again later.');
                } finally {
                    setLoading(false);
                }
            };

            const handleSearch = (e) => {
                e.preventDefault();
                searchHalalStatus(keyword);
            };

            const getStatusBadge = (status) => {
                const statusLower = status?.toLowerCase() || '';
                if (statusLower.includes('active') || statusLower.includes('valid')) {
                    return 'bg-green-100 text-green-800 border-green-300';
                } else if (statusLower.includes('expired') || statusLower.includes('inactive')) {
                    return 'bg-red-100 text-red-800 border-red-300';
                } else if (statusLower.includes('pending')) {
                    return 'bg-yellow-100 text-yellow-800 border-yellow-300';
                }
                return 'bg-gray-100 text-gray-800 border-gray-300';
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-emerald-50 via-white to-teal-50">
                    <div className="container mx-auto px-4 py-8 max-w-4xl">
                        {/* Header */}
                        <div className="text-center mb-8">
                            <div className="inline-block p-4 bg-emerald-600 rounded-full mb-4">
                                <i className="fas fa-check-circle text-white text-4xl"></i>
                            </div>
                            <h1 className="text-4xl font-bold text-gray-800 mb-2">
                                Malaysia Halal Status Checker
                            </h1>
                            <p className="text-gray-600">
                                Search for halal certification status of restaurants, products, and companies
                            </p>
                            <p className="text-sm text-gray-500 mt-2">
                                Powered by <span className="font-semibold">myehalal.halal.gov.my</span>
                            </p>
                        </div>

                        {/* Search Form */}
                        <div className="bg-white rounded-2xl shadow-lg p-6 mb-8">
                            <form onSubmit={handleSearch} className="space-y-4">
                                <div className="relative">
                                    <input
                                        type="text"
                                        value={keyword}
                                        onChange={(e) => setKeyword(e.target.value)}
                                        placeholder="Enter restaurant, product, or company name..."
                                        className="w-full px-6 py-4 text-lg border-2 border-gray-200 rounded-xl focus:outline-none focus:border-emerald-500 transition-colors"
                                    />
                                    <i className="fas fa-search absolute right-6 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                </div>
                                <button
                                    type="submit"
                                    disabled={loading}
                                    className="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-4 px-6 rounded-xl transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                >
                                    {loading ? (
                                        <>
                                            <i className="fas fa-spinner fa-spin"></i>
                                            Searching...
                                        </>
                                    ) : (
                                        <>
                                            <i className="fas fa-search"></i>
                                            Check Halal Status
                                        </>
                                    )}
                                </button>
                            </form>
                        </div>

                        {/* Error Message */}
                        {error && (
                            <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg mb-6">
                                <div className="flex items-center">
                                    <i className="fas fa-exclamation-circle text-red-500 mr-3"></i>
                                    <p className="text-red-700">{error}</p>
                                </div>
                            </div>
                        )}

                        {/* Results */}
                        {searched && !loading && (
                            <div className="space-y-4">
                                {results.length > 0 ? (
                                    <>
                                        <div className="flex items-center justify-between mb-4">
                                            <h2 className="text-2xl font-bold text-gray-800">
                                                Search Results ({results.length})
                                            </h2>
                                            <div className="flex items-center gap-2 text-emerald-600">
                                                <i className="fas fa-check-circle"></i>
                                                <span className="font-semibold">Halal Certified</span>
                                            </div>
                                        </div>

                                        {results.map((item, index) => (
                                            <div key={index} className="bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow border border-gray-100">
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <h3 className="text-xl font-bold text-gray-800 mb-2">
                                                            {item.companyName || item.name || item.productName || 'N/A'}
                                                        </h3>
                                                        {item.certificateNumber && (
                                                            <p className="text-sm text-gray-600 mb-1">
                                                                <i className="fas fa-certificate text-emerald-600 mr-2"></i>
                                                                <span className="font-semibold">Certificate:</span> {item.certificateNumber}
                                                            </p>
                                                        )}
                                                    </div>
                                                    {item.status && (
                                                        <span className={`px-4 py-2 rounded-full text-sm font-semibold border ${getStatusBadge(item.status)}`}>
                                                            {item.status}
                                                        </span>
                                                    )}
                                                </div>

                                                <div className="space-y-2 text-gray-700">
                                                    {item.address && (
                                                        <p className="flex items-start gap-2">
                                                            <i className="fas fa-map-marker-alt text-emerald-600 mt-1"></i>
                                                            <span>{item.address}</span>
                                                        </p>
                                                    )}
                                                    {item.companyType && (
                                                        <p className="flex items-center gap-2">
                                                            <i className="fas fa-building text-emerald-600"></i>
                                                            <span><span className="font-semibold">Type:</span> {item.companyType}</span>
                                                        </p>
                                                    )}
                                                    {item.certificateExpiry && (
                                                        <p className="flex items-center gap-2">
                                                            <i className="fas fa-calendar-alt text-emerald-600"></i>
                                                            <span><span className="font-semibold">Expiry:</span> {item.certificateExpiry}</span>
                                                        </p>
                                                    )}
                                                    {item.issuedDate && (
                                                        <p className="flex items-center gap-2">
                                                            <i className="fas fa-calendar-check text-emerald-600"></i>
                                                            <span><span className="font-semibold">Issued:</span> {item.issuedDate}</span>
                                                        </p>
                                                    )}
                                                    {item.productCategory && (
                                                        <p className="flex items-center gap-2">
                                                            <i className="fas fa-tag text-emerald-600"></i>
                                                            <span><span className="font-semibold">Category:</span> {item.productCategory}</span>
                                                        </p>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </>
                                ) : (
                                    <div className="bg-white rounded-xl shadow-md p-12 text-center">
                                        <div className="inline-block p-4 bg-gray-100 rounded-full mb-4">
                                            <i className="fas fa-search text-gray-400 text-4xl"></i>
                                        </div>
                                        <h3 className="text-xl font-bold text-gray-800 mb-2">No Results Found</h3>
                                        <p className="text-gray-600 mb-4">
                                            No halal certification found for "{keyword}"
                                        </p>
                                        <p className="text-sm text-gray-500">
                                            Try searching with a different keyword or check the spelling
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Info Section */}
                        <div className="mt-12 bg-emerald-50 rounded-xl p-6 border border-emerald-100">
                            <h3 className="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                                <i className="fas fa-info-circle text-emerald-600"></i>
                                About This Tool
                            </h3>
                            <ul className="space-y-2 text-gray-700 text-sm">
                                <li className="flex items-start gap-2">
                                    <i className="fas fa-check text-emerald-600 mt-1"></i>
                                    <span>Search for halal certified restaurants, products, and companies in Malaysia</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <i className="fas fa-check text-emerald-600 mt-1"></i>
                                    <span>Data is retrieved directly from the official Malaysian Halal Portal (JAKIM)</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <i className="fas fa-check text-emerald-600 mt-1"></i>
                                    <span>Results show current certification status and expiry dates</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <i className="fas fa-check text-emerald-600 mt-1"></i>
                                    <span>For official verification, visit <a href="https://myehalal.halal.gov.my" target="_blank" rel="noopener noreferrer" className="text-emerald-600 hover:underline font-semibold">myehalal.halal.gov.my</a></span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HalalChecker />);
    </script>
</body>
</html>
